#!/usr/bin/env zsh
#
# Outputs the shortest unique path needed for Zsh auto-completion
# to work without resorting to single subseshell or slow pipe.
# https://stackoverflow.com/a/45336078
#
#

local paths=(${PWD/#$HOME/\~}) 'cur_dir'
paths=(${(s:/:)PWD})
cur_path='/'
cur_short_path='/'
for directory in ${paths[@]}
do
  cur_dir=''
  for (( i=0; i<${#directory}; i++ )); do
    cur_dir+="${directory:$i:1}"
    matching=("$cur_path"/"$cur_dir"*/)
    if [[ ${#matching[@]} -eq 1 ]]; then
        break
    fi
  done
  cur_short_path+="$cur_dir/"
  cur_path+="$directory/"
done

printf %q "${cur_short_path: : -1}"
echo
